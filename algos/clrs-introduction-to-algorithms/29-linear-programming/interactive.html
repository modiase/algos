<!DOCTYPE html>
<html lang="en" data-theme="lpvisualizer">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linear Programming Equation Forms</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
</head>
<body>
  <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
      <div class="text-center mb-12 pt-8">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent p-3">
          Linear Programming Equation Forms
        </h1>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
        <div class="space-y-6">
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h2 class="card-title text-xl mb-4">Problem Definition</h2>

              <div class="grid grid-cols-2 gap-4">
                <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">Variables</span></label>
                  <input id="num-vars" type="number" min="1" max="10" value="2" class="input input-bordered input-primary">
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">Objective</span></label>
                  <select id="objective" class="select select-bordered select-primary">
                    <option value="maximize">Maximize</option>
                    <option value="minimize">Minimize</option>
                  </select>
                </div>
              </div>

              <div class="form-control mt-4">
                <div class="label"><span class="label-text font-semibold">Objective Coefficients</span></div>
                <div id="objective-coeffs" class="flex items-center gap-2 flex-wrap"></div>
              </div>
            </div>
          </div>

          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <div class="flex justify-between items-center mb-4">
                <h2 class="card-title text-xl">Constraints</h2>
                <button id="add-constraint" class="btn btn-success btn-sm gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                  Add
                </button>
              </div>
              <div id="constraints" class="space-y-3 max-h-96 overflow-y-auto pr-2"></div>
            </div>
          </div>
        </div>

        <div class="space-y-6">
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h2 class="card-title text-xl mb-4">Display Options</h2>

              <div class="space-y-6">
                <div class="form-control">
                  <div class="label"><span class="label-text font-semibold">Form Type</span></div>
                  <div class="flex gap-2">
                    <button data-form="given" class="btn btn-sm flex-1 btn-primary shadow-md">Given</button>
                    <button data-form="standard" class="btn btn-sm flex-1 btn-outline btn-primary">Standard</button>
                    <button data-form="slack" class="btn btn-sm flex-1 btn-outline btn-primary">Slack</button>
                  </div>
                </div>

                <div class="form-control">
                  <div class="label"><span class="label-text font-semibold">Display Mode</span></div>
                  <div class="flex gap-2">
                    <button data-display="compact" class="btn btn-sm flex-1 btn-secondary shadow-md">Full</button>
                    <button data-display="full" class="btn btn-sm flex-1 btn-outline btn-secondary">Matrix</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <div class="flex justify-between items-start mb-2">
                <h2 id="form-title" class="card-title text-xl">Given Form</h2>
                <div id="var-count" class="text-xs bg-base-200 px-3 py-1 rounded-full"></div>
              </div>
              <div class="divider my-0"></div>
              <div id="latex-display" class="overflow-x-auto py-4"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SESSION_KEY = 'lp-visualizer-state';

    const state = {
      numVars: 2,
      objective: 'maximize',
      objectiveCoefficients: [1, 1],
      constraints: [
        { id: '1', coefficients: [1, 1], operator: '<=', rhs: 10 },
        { id: '2', coefficients: [2, 1], operator: '<=', rhs: 15 }
      ],
      formType: 'given',
      displayMode: 'compact'
    };

    function loadState() {
      try {
        const saved = sessionStorage.getItem(SESSION_KEY);
        if (saved) Object.assign(state, JSON.parse(saved));
      } catch {}
    }

    function saveState() {
      try {
        sessionStorage.setItem(SESSION_KEY, JSON.stringify(state));
      } catch {}
    }

    function formatTerm(coef, varName, isFirst) {
      if (coef === 0) return '';
      const sign = coef > 0 ? (isFirst ? '' : ' + ') : ' - ';
      const absCoef = Math.abs(coef);
      const coefStr = absCoef === 1 ? '' : absCoef.toString();
      return `${sign}${coefStr}${varName}`;
    }

    function formatObjective(coefficients, variableNames) {
      return coefficients
        .map((c, i) => formatTerm(c, variableNames[i], i === 0))
        .filter(t => t !== '')
        .join('');
    }

    function formatConstraintCompact(coefficients, operator, rhs, variableNames) {
      const lhs = coefficients
        .map((c, i) => formatTerm(c, variableNames[i], i === 0))
        .filter(t => t !== '')
        .join('');
      return `${lhs} ${operator} ${rhs}`;
    }

    function formatCompact(problem) {
      const objective = problem.objective === 'maximize' ? '\\text{maximize}' : '\\text{minimize}';
      const objFunc = formatObjective(problem.objectiveCoefficients, problem.variableNames);
      const constraintLines = problem.constraints
        .map(c => formatConstraintCompact(c.coefficients, c.operator, c.rhs, problem.variableNames))
        .map((constraint, i) => i === 0 ? constraint : `& ${constraint}`)
        .join(' \\\\ ');
      return `\\begin{aligned}\n${objective} \\quad & ${objFunc} \\\\\n\\text{subject to} \\quad & ${constraintLines}\n\\end{aligned}`;
    }

    function formatFull(problem) {
      const objective = problem.objective === 'maximize' ? '\\text{maximize}' : '\\text{minimize}';
      const numVars = problem.variableNames.length;
      return `\\begin{aligned}\n${objective} \\quad & c^T x = \\begin{bmatrix} ${problem.objectiveCoefficients.join(' \\\\ ')} \\end{bmatrix}^T \\begin{bmatrix} ${problem.variableNames.join(' \\\\ ')} \\end{bmatrix} \\\\\n\\text{subject to} \\quad & \\begin{bmatrix} ${problem.constraints.map(c => c.coefficients.slice(0, numVars).join(' & ')).join(' \\\\ ')} \\end{bmatrix} \\begin{bmatrix} ${problem.variableNames.join(' \\\\ ')} \\end{bmatrix}\n\\begin{bmatrix} ${problem.constraints.map(c => c.operator).join(' \\\\ ')} \\end{bmatrix} \\begin{bmatrix} ${problem.constraints.map(c => c.rhs).join(' \\\\ ')} \\end{bmatrix}\n\\end{aligned}`;
    }

    function inferUnrestrictedVariables(constraints, numVars) {
      const restricted = new Array(numVars).fill(false);
      for (const constraint of constraints) {
        const nonZeroCoeffs = constraint.coefficients
          .map((c, i) => ({ coeff: c, index: i }))
          .filter(({ coeff }) => coeff !== 0);
        if (nonZeroCoeffs.length === 1) {
          const { coeff, index } = nonZeroCoeffs[0];
          if (constraint.operator === '>=' && constraint.rhs >= 0 && coeff > 0) {
            restricted[index] = true;
          }
        }
      }
      return restricted.map(r => !r);
    }

    function toStandardForm(problem) {
      const isMinimize = problem.objective === 'minimize';
      const numOriginalVars = problem.variableNames.length;
      const baseObjectiveCoefficients = isMinimize
        ? problem.objectiveCoefficients.map(c => -c)
        : problem.objectiveCoefficients;

      const expandedObjectiveCoefficients = [];
      const expandedVariableNames = [];

      for (let i = 0; i < numOriginalVars; i++) {
        if (problem.unrestrictedVariables[i]) {
          expandedObjectiveCoefficients.push(baseObjectiveCoefficients[i]);
          expandedObjectiveCoefficients.push(-baseObjectiveCoefficients[i]);
          expandedVariableNames.push(`x_{${i + 1}}^+`);
          expandedVariableNames.push(`x_{${i + 1}}^-`);
        } else {
          expandedObjectiveCoefficients.push(baseObjectiveCoefficients[i]);
          expandedVariableNames.push(problem.variableNames[i]);
        }
      }

      const expandConstraintCoefficients = (coeffs) => {
        const expanded = [];
        for (let i = 0; i < numOriginalVars; i++) {
          if (problem.unrestrictedVariables[i]) {
            expanded.push(coeffs[i]);
            expanded.push(-coeffs[i]);
          } else {
            expanded.push(coeffs[i]);
          }
        }
        return expanded;
      };

      const constraints = [];
      problem.constraints.forEach(c => {
        const expandedCoeffs = expandConstraintCoefficients(c.coefficients);
        if (c.operator === '>=') {
          constraints.push({
            ...c,
            coefficients: expandedCoeffs.map(v => -v),
            operator: '<=',
            rhs: -c.rhs
          });
        } else if (c.operator === '=') {
          constraints.push({ ...c, coefficients: expandedCoeffs, operator: '<=', rhs: c.rhs });
          constraints.push({ ...c, coefficients: expandedCoeffs.map(v => -v), operator: '<=', rhs: -c.rhs });
        } else {
          constraints.push({ ...c, coefficients: expandedCoeffs, operator: '<=', rhs: c.rhs });
        }
      });

      return {
        objective: 'maximize',
        objectiveCoefficients: expandedObjectiveCoefficients,
        constraints,
        variableNames: expandedVariableNames
      };
    }

    function toSlackForm(standard) {
      const slackVariables = [];
      const newConstraints = [];
      const numOriginalVars = standard.variableNames.length;

      standard.constraints.forEach((c, i) => {
        const slackName = `s_{${i + 1}}`;
        slackVariables.push(slackName);
        const newCoefficients = [...c.coefficients];
        for (let j = 0; j < slackVariables.length - 1; j++) {
          newCoefficients.push(0);
        }
        newCoefficients.push(1);
        newConstraints.push({ ...c, coefficients: newCoefficients, operator: '=' });
      });

      const extendedObjective = [
        ...standard.objectiveCoefficients,
        ...new Array(slackVariables.length).fill(0)
      ];

      return {
        objective: standard.objective,
        objectiveCoefficients: extendedObjective,
        constraints: newConstraints,
        variableNames: [...standard.variableNames, ...slackVariables],
        slackVariables
      };
    }

    function getCurrentProblem() {
      return {
        objective: state.objective,
        objectiveCoefficients: state.objectiveCoefficients,
        constraints: state.constraints,
        variableNames: Array(state.numVars).fill(0).map((_, i) => `x_{${i + 1}}`),
        unrestrictedVariables: inferUnrestrictedVariables(state.constraints, state.numVars)
      };
    }

    function getDisplayProblem() {
      const current = getCurrentProblem();
      if (state.formType === 'given') return current;
      const standard = toStandardForm(current);
      if (state.formType === 'standard') return standard;
      return toSlackForm(standard);
    }

    function renderLatex() {
      const problem = getDisplayProblem();
      const latex = state.displayMode === 'compact' ? formatCompact(problem) : formatFull(problem);
      const el = document.getElementById('latex-display');
      katex.render(latex, el, { displayMode: true, throwOnError: false });

      document.getElementById('form-title').textContent =
        state.formType === 'given' ? 'Given Form' :
        state.formType === 'standard' ? 'Standard Form' : 'Slack Form';

      document.getElementById('var-count').textContent =
        `${problem.variableNames.length} vars · ${problem.constraints.length} constraints`;
    }

    function renderObjectiveCoeffs() {
      const container = document.getElementById('objective-coeffs');
      container.innerHTML = '';
      state.objectiveCoefficients.forEach((coef, i) => {
        const div = document.createElement('div');
        div.className = 'relative';
        div.innerHTML = `
          <input type="number" value="${coef}" step="any" class="input input-bordered input-sm w-14 pr-7" data-obj-coef="${i}">
          <span class="absolute right-1.5 top-1/2 -translate-y-1/2 text-xs text-base-content/60 pointer-events-none">x<sub>${i + 1}</sub></span>
        `;
        container.appendChild(div);
        if (i < state.numVars - 1) {
          const plus = document.createElement('span');
          plus.className = 'text-sm font-medium';
          plus.textContent = '+';
          container.appendChild(plus);
        }
      });
    }

    function renderConstraints() {
      const container = document.getElementById('constraints');
      container.innerHTML = '';
      state.constraints.forEach(constraint => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-2 p-4 bg-base-200 rounded-lg border border-base-300 hover:shadow-md transition-shadow';

        let html = '<div class="flex items-center gap-2 flex-wrap flex-1">';
        for (let i = 0; i < state.numVars; i++) {
          html += `
            <div class="relative">
              <input type="number" value="${constraint.coefficients[i] || 0}" step="any"
                class="input input-bordered input-sm w-14 pr-7" data-constraint="${constraint.id}" data-coef="${i}">
              <span class="absolute right-1.5 top-1/2 -translate-y-1/2 text-xs text-base-content/60 pointer-events-none">x<sub>${i + 1}</sub></span>
            </div>
          `;
          if (i < state.numVars - 1) html += '<span class="text-sm font-medium">+</span>';
        }
        html += `
          <div class="flex items-center gap-1 bg-base-100 border border-base-300 rounded-lg px-2 py-1">
            <select class="select select-sm border-0 focus:outline-none w-12 p-0" data-constraint="${constraint.id}" data-op>
              <option value="<=" ${constraint.operator === '<=' ? 'selected' : ''}>≤</option>
              <option value=">=" ${constraint.operator === '>=' ? 'selected' : ''}>≥</option>
              <option value="=" ${constraint.operator === '=' ? 'selected' : ''}>=</option>
            </select>
            <input type="number" value="${constraint.rhs}" step="any" class="input input-sm border-0 focus:outline-none w-16 p-1"
              data-constraint="${constraint.id}" data-rhs>
          </div>
        </div>
        <button class="btn btn-error btn-sm btn-circle" data-remove="${constraint.id}" title="Remove constraint">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        `;
        div.innerHTML = html;
        container.appendChild(div);
      });
    }

    function render() {
      renderObjectiveCoeffs();
      renderConstraints();
      renderLatex();
      saveState();
    }

    loadState();

    document.getElementById('num-vars').value = state.numVars;
    document.getElementById('objective').value = state.objective;

    document.getElementById('num-vars').addEventListener('input', e => {
      state.numVars = parseInt(e.target.value) || 2;
      state.objectiveCoefficients = Array(state.numVars).fill(0).map((_, i) => state.objectiveCoefficients[i] || 1);
      state.constraints = state.constraints.map(c => ({
        ...c,
        coefficients: Array(state.numVars).fill(0).map((_, i) => c.coefficients[i] || 0)
      }));
      render();
    });

    document.getElementById('objective').addEventListener('change', e => {
      state.objective = e.target.value;
      render();
    });

    document.getElementById('add-constraint').addEventListener('click', () => {
      state.constraints.push({
        id: Date.now().toString(),
        coefficients: Array(state.numVars).fill(0),
        operator: '<=',
        rhs: 0
      });
      render();
    });

    document.addEventListener('click', e => {
      if (e.target.matches('[data-form]')) {
        state.formType = e.target.dataset.form;
        document.querySelectorAll('[data-form]').forEach(btn => {
          btn.className = btn === e.target
            ? 'btn btn-sm flex-1 btn-primary shadow-md'
            : 'btn btn-sm flex-1 btn-outline btn-primary';
        });
        render();
      }
      if (e.target.matches('[data-display]')) {
        state.displayMode = e.target.dataset.display;
        document.querySelectorAll('[data-display]').forEach(btn => {
          btn.className = btn === e.target
            ? 'btn btn-sm flex-1 btn-secondary shadow-md'
            : 'btn btn-sm flex-1 btn-outline btn-secondary';
        });
        render();
      }
      if (e.target.matches('[data-remove]')) {
        state.constraints = state.constraints.filter(c => c.id !== e.target.dataset.remove);
        render();
      }
    });

    document.addEventListener('input', e => {
      if (e.target.matches('[data-obj-coef]')) {
        const idx = parseInt(e.target.dataset.objCoef);
        state.objectiveCoefficients[idx] = parseFloat(e.target.value) || 0;
        renderLatex();
        saveState();
      }
      if (e.target.matches('[data-constraint][data-coef]')) {
        const id = e.target.dataset.constraint;
        const idx = parseInt(e.target.dataset.coef);
        const c = state.constraints.find(c => c.id === id);
        if (c) {
          c.coefficients[idx] = parseFloat(e.target.value) || 0;
          renderLatex();
          saveState();
        }
      }
      if (e.target.matches('[data-constraint][data-rhs]')) {
        const id = e.target.dataset.constraint;
        const c = state.constraints.find(c => c.id === id);
        if (c) {
          c.rhs = parseFloat(e.target.value) || 0;
          renderLatex();
          saveState();
        }
      }
    });

    document.addEventListener('change', e => {
      if (e.target.matches('[data-constraint][data-op]')) {
        const id = e.target.dataset.constraint;
        const c = state.constraints.find(c => c.id === id);
        if (c) {
          c.operator = e.target.value;
          renderLatex();
          saveState();
        }
      }
    });

    render();
  </script>
</body>
</html>
